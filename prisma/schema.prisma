// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider     = "prisma-client"
  output       = "../src/generated/prisma"
  moduleFormat = "cjs"
}

datasource db {
  provider = "sqlite"
}

model UserAdmin {
  id           Int    @id @default(autoincrement())
  email        String @unique
  passwordHash String
}

model Position {
  id           Int           @id @default(autoincrement())
  lat          Int
  lng          Int
  userCouriers UserCourier[]
}

model Order {
  id              Int           @id @default(autoincrement())
  description     String        @default("")
  weight          String        @default("")
  size            String        @default("")
  volume          String        @default("")
  orderedAt       Int           @default(-1)
  completedAt     Int           @default(-1)
  senderLat       Int           @default(0)
  senderLng       Int           @default(0)
  receiverLat     Int           @default(0)
  receiverLng     Int           @default(0)
  clientRates     ClientRate[]
  courierRates    CourierRate[]
  senderAddress   String
  sender          UserClient    @relation("SenderOrders", fields: [senderId], references: [id])
  senderId        Int           @default(-1)
  receiverAddress String
  receiver        UserClient    @relation("ReceiverOrders", fields: [receiverId], references: [id])
  receiverId      Int           @default(-1)
  courier         UserCourier?  @relation(fields: [courierId], references: [id])
  courierId       Int?          @default(-1)
  status          String        @default("ordered")
}

model UserCourier {
  id                   Int           @id @default(autoincrement())
  email                String        @unique
  passwordHash         String
  status               String        @default("offline")
  name                 String
  phone                String
  position             Position      @relation(fields: [positionId], references: [id])
  positionId           Int
  clientRates          ClientRate[]
  courierRates         CourierRate[]
  orders               Order[]
  activeOrdersCount    Int           @default(0)
  completedOrdersCount Int           @default(0)
  totalOrdersCount     Int           @default(0)
}

model UserClient {
  id             Int           @id @default(autoincrement())
  email          String        @unique
  passwordHash   String
  name           String
  phone          String
  clientRates    ClientRate[]
  courierRates   CourierRate[]
  senderOrders   Order[]       @relation("SenderOrders")
  receiverOrders Order[]       @relation("ReceiverOrders")
}

model ClientRate {
  rating    Int
  client    UserClient  @relation(fields: [clientId], references: [id])
  clientId  Int
  courier   UserCourier @relation(fields: [courierId], references: [id])
  courierId Int
  order     Order       @relation(fields: [orderId], references: [id])
  orderId   Int

  @@id([clientId, courierId, orderId])
}

model CourierRate {
  rating    Int
  client    UserClient  @relation(fields: [clientId], references: [id])
  clientId  Int
  courier   UserCourier @relation(fields: [courierId], references: [id])
  courierId Int
  order     Order       @relation(fields: [orderId], references: [id])
  orderId   Int

  @@id([clientId, courierId, orderId])
}

model ResetPasswordToken {
  id      Int    @id @default(autoincrement())
  token   String
  expires Int
  userId  Int
}
